//------------------------------------------------------------------------------
// <auto-generated />
//
// This file was automatically generated by SWIG (http://www.swig.org).
// Version 3.0.10
//
// Do not make changes to this file unless you know what you are doing--modify
// the SWIG interface file instead.
//------------------------------------------------------------------------------


using System;
using System.Runtime.InteropServices;

namespace Noesis
{

public abstract class ShaderEffect : Effect {
  internal ShaderEffect(IntPtr cPtr, bool cMemoryOwn) : base(cPtr, cMemoryOwn) {
  }

  internal static HandleRef getCPtr(ShaderEffect obj) {
    return (obj == null) ? new HandleRef(null, IntPtr.Zero) : obj.swigCPtr;
  }

  protected ShaderEffect() {
  }

  ~ShaderEffect() {
    if (_constantsHandle.IsAllocated) {
      _constantsHandle.Free();
    }
  }

  protected void SetConstantBuffer<T>(T constants) where T : class {
    if (constants == null) {
      Log.Error("Null argument 'constants'");
      return;
    }
    if (!typeof(T).IsLayoutSequential) {
      Log.Error("Constants class must have [StructLayout(LayoutKind.Sequential)] applied");
      return;
    }
    _constantsHandle = GCHandle.Alloc(constants, GCHandleType.Pinned);
    SetConstantBuffer(_constantsHandle.AddrOfPinnedObject(), (uint)Marshal.SizeOf<T>());
  }

  private GCHandle _constantsHandle;

#if UNITY_5_3_OR_NEWER
  protected NoesisShader CreateShader() {
    string name = GetType().Name.Replace("Effect", ".noesiseffect");
    NoesisShader shader = NoesisShaderProvider.instance.GetShader(name);

    if (shader != null) {
      shader.effect = NoesisRenderer.CreatePixelShader((byte)Shader.Enum.Custom_Effect, 0, shader.effect_bytecode);
      return shader;
    }

    Log.Error($"Can't find asset '{name}' for class '{GetType().Name}'");
    return null;
  }

  public void SetShader(NoesisShader shader) {
    if (shader != null) {
      SetPixelShader(shader.effect);
    }
  }
#endif

  protected void SetPadding(float left, float top, float right, float bottom) {
    NoesisGUI_PINVOKE.ShaderEffect_SetPadding(swigCPtr, left, top, right, bottom);
  }

  protected void SetPixelShader(IntPtr value) {
    NoesisGUI_PINVOKE.ShaderEffect_SetPixelShader(swigCPtr, value);
  }

  private void SetConstantBuffer(IntPtr buffer, uint size) {
    NoesisGUI_PINVOKE.ShaderEffect_SetConstantBuffer(swigCPtr, buffer, size);
  }

  protected void InvalidateConstantBuffer() {
    NoesisGUI_PINVOKE.ShaderEffect_InvalidateConstantBuffer(swigCPtr);
  }

  internal new static IntPtr Extend(string typeName) {
    return NoesisGUI_PINVOKE.Extend_ShaderEffect(Marshal.StringToHGlobalAnsi(typeName));
  }
}

}

